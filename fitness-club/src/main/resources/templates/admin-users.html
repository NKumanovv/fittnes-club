<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/typography.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="stylesheet" type="text/css" href="/css/admin-users.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>Admin Dashboard</title>
</head>
<body>
<div class="container">
    <main>
        <div th:replace="~{fragments/common/nav-bar :: navbar}"></div>

        <div class="content" style="flex-grow: 1;">
            <h2>User Management</h2>
            <p>Manage access permissions for all registered users.</p>

            <table>
                <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="u : ${users}">
                    <td th:text="${u.username}">User123</td>
                    <td th:text="${u.email}">user@example.com</td>
                    <td>
                    <span th:if="${u.username == currentUsername}"
                          th:text="${u.role}"
                          style="font-weight: bold; color: gray;">
                    </span>

                        <div th:if="${u.username != currentUsername}">
                            <form th:action="@{/admin/users/{id}/change-role(id=${u.id})}" method="POST">

                                <select name="role" onchange="this.form.submit()"
                                        style="padding: 5px; border-radius: 5px; border: 1px solid #ccc;">

                                    <option th:each="r : ${T(com.fitness_club.user.model.UserRole).values()}"
                                            th:value="${r}"
                                            th:text="${r}"
                                            th:selected="${r == u.role}">
                                    </option>
                                </select>

                            </form>
                        </div>
                    </td>

                    <td>
                        <span th:if="${u.active}" class="status-active">Active</span>
                        <span th:unless="${u.active}" class="status-blocked">Blocked</span>
                    </td>

                    <td>
                        <div>
                            <form th:action="@{/admin/users/{id}/toggle-status(id=${u.id})}" method="POST">
                                <button type="submit"
                                        th:class="${u.active} ? 'btn-block' : 'btn-unblock'"
                                        th:text="${u.active} ? 'Block' : 'Unblock'">
                                    Block
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </main>

    <th:block th:insert="~{fragments/common/footer :: footer}"></th:block>
</div>

</body>
</html>